<template>
  <div>
    <ListingWrap class="photo-gallery preview-img-list">
      <ListItem :cols="item.size" v-for="(item, index) in slots" :key="item.id">
        <FigureWrap class="photo-gallery__figure" :caption="captions && item.title">
          <div :class="`preview-img-item ${ noPopup === false ? '' : ' preview-img-item--nolink'}`" :style="`background-image:url(${item.src})`" @click="noPopup === false && open(index, slots, options)"></div>
        </FigureWrap>
      </ListItem>
    </ListingWrap>
    <PhotoSwipeMarkup />
  </div>
</template>

<script>
import 'photoswipe/dist/photoswipe.css';
import 'photoswipe/dist/default-skin/default-skin.css';
import PhotoSwipe from 'photoswipe/dist/photoswipe';
import PhotoSwipeDefaultUI from 'photoswipe/dist/photoswipe-ui-default';
import ListingWrap from './../listing/ListingWrap.vue';
import FigureWrap from './../figure/FigureWrap.vue';
import ListItem from './../listing/ListItem.vue';
import PhotoSwipeMarkup from './PhotoSwipeMarkup.vue';

export default {
  components: {
    ListingWrap,
    ListItem,
    FigureWrap,
    PhotoSwipeMarkup,
  },
  props: {
    cols: {
      type: String,
      default: 'four',
    },
    images: {
      type: Array,
    },
    captions: Boolean,
    fullScreen: Boolean,
    options: Object,
    noPopup: {
      type: Boolean,
      default: false,
    },
  },
  computed: {
    slots() {
      return this.$slots.default.map(node => ({
        src: node.data.attrs.src,
        msrc: node.data.attrs['data-thumb'],
        w: node.data.attrs.width,
        h: node.data.attrs.height,
        title: node.data.attrs['data-title'],
        size: node.data.attrs['data-size'],
      }));
    },
  },
  methods: {
    open(
      index,
      items,
      options = {
        showHideOpacity: true,
        getThumbBoundsFn: false,
        shareEl: false,
        fullscreenEl: this.fullScreen,
        closeOnScroll: false,
        bgOpacity: 0.95,
      }
    ) {
      this.photoswipe = new PhotoSwipe(
        this.$el.querySelector('.pswp'),
        PhotoSwipeDefaultUI,
        items,
        options
      );
      this.photoswipe.init();
    },
    close() {
      this.photoswipe.close();
    },
  },
};
</script>
